<div class="mx-auto max-w-7xl px-4 py-8">
  <div class="mb-6 flex items-center justify-between">
    <h1 class="text-3xl font-bold text-gray-900">
      @if (authService.isTeacher()) {
        <span>My Courses</span>
      } @else {
        <span>Available Courses</span>
      }
    </h1>

    @if (authService.isTeacher()) {
      <a
        routerLink="/courses/create"
        class="rounded-md bg-blue-600 px-4 py-2 text-white hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2"
      >
        Create Course
      </a>
    }
  </div>

  <!-- Search Bar and Filters -->
  <div class="mb-6 space-y-4">
    <input
      type="text"
      placeholder="Search courses..."
      (input)="onSearch($event)"
      class="w-full rounded-md border border-gray-300 px-4 py-2 focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500"
    />
    
    @if (authService.isTeacher()) {
      <div class="flex items-center gap-4">
        <label class="text-sm font-medium text-gray-700">Filter by status:</label>
        <div class="flex gap-3">
          <label class="flex items-center gap-2 cursor-pointer">
            <input
              type="radio"
              name="statusFilter"
              [checked]="statusFilter() === 'all'"
              (change)="onStatusChange('all')"
              class="h-4 w-4 border-gray-300 text-blue-600 focus:ring-blue-500"
            />
            <span class="text-sm text-gray-700">All</span>
          </label>
          <label class="flex items-center gap-2 cursor-pointer">
            <input
              type="radio"
              name="statusFilter"
              [checked]="statusFilter() === 'draft'"
              (change)="onStatusChange('draft')"
              class="h-4 w-4 border-gray-300 text-blue-600 focus:ring-blue-500"
            />
            <span class="text-sm text-gray-700">Draft</span>
          </label>
          <label class="flex items-center gap-2 cursor-pointer">
            <input
              type="radio"
              name="statusFilter"
              [checked]="statusFilter() === 'published'"
              (change)="onStatusChange('published')"
              class="h-4 w-4 border-gray-300 text-blue-600 focus:ring-blue-500"
            />
            <span class="text-sm text-gray-700">Published</span>
          </label>
        </div>
      </div>
    }
  </div>

  @if (errorMessage()) {
    <div class="mb-6 rounded-md bg-red-50 p-4">
      <p class="text-sm text-red-800">{{ errorMessage() }}</p>
    </div>
  }

  @if (isLoading()) {
    <div class="flex items-center justify-center py-12">
      <p class="text-gray-500">Loading courses...</p>
    </div>
  } @else {
    @if (filteredCourses().length === 0) {
      <div class="rounded-lg border border-gray-200 bg-white p-12 text-center">
        <p class="text-gray-500">
          @if (searchQuery()) {
            No courses found matching "{{ searchQuery() }}"
          } @else if (authService.isTeacher()) {
            You haven't created any courses yet. Click "Create Course" to get started.
          } @else {
            No courses available at the moment.
          }
        </p>
      </div>
    } @else {
      <div class="grid gap-6 md:grid-cols-2 lg:grid-cols-3">
        @for (course of filteredCourses(); track course.id) {
          <div class="rounded-lg border border-gray-200 bg-white p-6 shadow-sm transition-shadow hover:shadow-md">
            <div class="mb-3 flex items-start justify-between">
              <h3 class="text-xl font-semibold text-gray-900">
                <a [routerLink]="['/courses', course.id]" class="hover:text-blue-600">
                  {{ course.title }}
                </a>
              </h3>
              <div class="flex flex-col items-end gap-1">
                <span
                  [class]="'rounded-full px-2 py-1 text-xs font-semibold ' + getStatusBadgeClass(course.status)"
                >
                  {{ getStatusText(course.status) }}
                </span>
                @if (authService.isStudent() && isEnrolledIn(course.id)) {
                  <span class="rounded-full bg-blue-100 px-2 py-1 text-xs font-semibold text-blue-800 text-center">
                    Enrolled
                  </span>
                }
              </div>
            </div>

            <div class="mb-4 line-clamp-2 text-sm text-gray-600 markdown-content" [innerHTML]="renderDescription(course.description)">
            </div>

            <div class="mb-4 flex items-center gap-4 text-sm text-gray-500">
              <span>ğŸ‘¤ {{ course.instructorName }}</span>
            </div>

            <div class="mb-4 flex items-center gap-4 text-sm text-gray-500">
              <span>ğŸ“š {{ course.chaptersCount }} chapters</span>
              <span>ğŸ“ {{ course.totalBlocks }} blocks</span>
            </div>

            @if (authService.isStudent() && isEnrolledIn(course.id)) {
              <div class="mb-4">
                <div class="flex items-center justify-between text-xs text-gray-600 mb-1">
                  <span>Your Progress</span>
                  <span class="font-semibold">{{ getCourseProgress(course.id) }}%</span>
                </div>
                <div class="h-2 w-full rounded-full bg-gray-200 overflow-hidden">
                  <div
                    class="h-full bg-blue-500 transition-all duration-300"
                    [style.width.%]="getCourseProgress(course.id)"
                  ></div>
                </div>
              </div>
            }

            <div class="flex gap-2">
              @if (authService.isStudent()) {
                @if (isEnrolledIn(course.id)) {
                  <a
                    [routerLink]="['/learn', course.id]"
                    class="flex-1 rounded-md bg-blue-600 px-4 py-2 text-center text-sm font-medium text-white hover:bg-blue-700"
                  >
                    Continue Learning
                  </a>
                  <a
                    [routerLink]="['/courses', course.id]"
                    class="rounded-md border border-gray-300 bg-white px-4 py-2 text-center text-sm font-medium text-gray-700 hover:bg-gray-50"
                  >
                    Details
                  </a>
                } @else {
                  <a
                    [routerLink]="['/courses', course.id]"
                    class="flex-1 rounded-md bg-blue-600 px-4 py-2 text-center text-sm font-medium text-white hover:bg-blue-700"
                  >
                    View Details
                  </a>
                }
              } @else {
                <a
                  [routerLink]="['/courses', course.id]"
                  class="flex-1 rounded-md border border-gray-300 bg-white px-4 py-2 text-center text-sm font-medium text-gray-700 hover:bg-gray-50"
                >
                  View Details
                </a>

                @if (course.status === CourseStatus.Draft) {
                  <a
                    [routerLink]="['/courses', course.id, 'edit']"
                    class="flex-1 rounded-md bg-blue-600 px-4 py-2 text-center text-sm font-medium text-white hover:bg-blue-700"
                  >
                    Edit
                  </a>
                }
              }
            </div>
          </div>
        }
      </div>
    }
  }
</div>
